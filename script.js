function bukaPopupEdit(){const a=getFullData();document.getElementById("editableTasks").value=a.tasksCustom||daftarKegiatan.join("\n"),document.getElementById("popupEdit").style.display="block"}function tutupPopupEdit(){document.getElementById("popupEdit").style.display="none"}function simpanDanTutup(){muatTabel(),tutupPopupEdit()}function setChartWarningVisibility(a){document.getElementById("chartWarning").style.display=a?"block":"none",localStorage.setItem("chartWarningVisible",a?"true":"false")}function applyChartWarningFromStorage(){const a=localStorage.getItem("chartWarningVisible");setChartWarningVisibility(null===a||"true"===a)}function simpanNamaAvatar(){localStorage.setItem("nativeUserName",document.getElementById("userName").textContent.trim()),localStorage.setItem("nativeUserAvatar",document.getElementById("userAvatar").textContent.trim())}function tampilkanNamaAvatar(){const a=localStorage.getItem("nativeUserName")||"Klik untuk edit nama",t=localStorage.getItem("nativeUserAvatar")||"ğŸ‘¤";document.getElementById("userName").textContent=a,document.getElementById("userAvatar").textContent=t}function getFullData(){return JSON.parse(localStorage.getItem("nativeDailyFullData"))||{tasksCustom:null,dailyData:[],checklist:{},totalPoint:0}}function saveFullData(a){localStorage.setItem("nativeDailyFullData",JSON.stringify(a))}document.getElementById("userName").addEventListener("blur",simpanNamaAvatar),document.getElementById("userAvatar").addEventListener("blur",simpanNamaAvatar),tampilkanNamaAvatar();let daftarKegiatan=["Bangun Pagi","Beribadah Tepat Waktu","Berolahraga Rutin","Makan Sehat dan Bergizi","Gemar Belajar","Bermasyarakat dan Membantu Sesama","Tidur Lebih Awal"];const tbody=document.querySelector("#todoTable tbody"),textarea=document.getElementById("editableTasks"),todayKey=`nativeChecklist-${(new Date).toISOString().split("T")[0]}`,initialData=getFullData();function muatTabel(){const a=textarea.value.trim(),t=getFullData();t.tasksCustom=a,saveFullData(t),daftarKegiatan=a.split("\n").map((a=>a.trim())).filter((a=>a)),tbody.innerHTML="";const e=t.checklist[todayKey]||[];daftarKegiatan.forEach(((a,t)=>{const n=document.createElement("tr");n.innerHTML=`\n        <td>${a}</td>\n        <td><input type="checkbox" id="kegiatan-${t}" ${e.includes(t)?"checked":""}></td>\n      `,tbody.appendChild(n),document.getElementById(`kegiatan-${t}`).addEventListener("change",(()=>{const a=daftarKegiatan.map(((a,t)=>{const e=document.getElementById(`kegiatan-${t}`);return e&&e.checked?t:null})).filter((a=>null!==a)),t=getFullData();t.checklist[todayKey]=a,saveFullData(t)}))}))}function simpanData(){const a=(new Date).toISOString().split("T")[0];let t=0;daftarKegiatan.forEach(((a,e)=>{document.getElementById(`kegiatan-${e}`).checked&&t++}));const e=getFullData(),n=e.dailyData.findIndex((t=>t.tanggal===a));-1!==n&&e.dailyData.splice(n,1);const i=daftarKegiatan.filter(((a,t)=>{const e=document.getElementById(`kegiatan-${t}`);return e&&e.checked}));e.dailyData.push({tanggal:a,skor:t,selesai:i});const l=e.dailyData.reduce(((a,t)=>a+t.skor),0);e.totalPoint=l,saveFullData(e),updateProgressIndicators(),tampilkanGrafik(e.dailyData),hitungTotalPoin(),alert("âœ… Data berhasil disimpan!"),setChartWarningVisibility(!1),daftarKegiatan.forEach(((a,t)=>{const e=document.getElementById(`kegiatan-${t}`);e&&(e.checked=!1)})),hitungRataRata()}function tampilkanGrafik(a){const t=document.getElementById("progressChart").getContext("2d"),e=a.map((a=>a.tanggal)),n=a.map((a=>a.skor));window.grafik&&window.grafik.destroy(),window.grafik=new Chart(t,{type:"line",data:{labels:e,datasets:[{label:"Skor Harian",data:n,borderColor:"#00ff99",backgroundColor:"#00ff9940",fill:!0,tension:.4,pointBackgroundColor:"#00ff99"}]},options:{responsive:!0,scales:{y:{min:0,max:daftarKegiatan.length,ticks:{stepSize:1}}}}})}function hitungTotalPoin(){const a=getFullData().totalPoint||0;document.getElementById("totalPoint").textContent=a,tampilkanRank(a)}function tampilkanRank(a){const t=[{min:0,rank:"ğŸŒ± Pemula",motivasi:"â€œLangkah kecil hari ini adalah awal dari kemenangan besar besok.â€ â€“ Unknown"},{min:10,rank:"ğŸ’ª Pelatih Diri",motivasi:"â€œOrang hebat tak dilahirkan, mereka ditempa.â€ â€“ Cristiano Ronaldo"},{min:20,rank:"ğŸ”¥ Pejuang",motivasi:"â€œJangan menyerah, menderitalah sekarang dan hiduplah sebagai juara selamanya.â€ â€“ Muhammad Ali"},{min:35,rank:"ğŸš€ Pendaki",motivasi:"â€œKeberhasilan bukanlah kebetulan.â€ â€“ Pele"},{min:50,rank:"ğŸ§  Master",motivasi:"â€œKeunggulan adalah hasil dari kebiasaan, bukan tindakan sesekali.â€ â€“ Aristoteles"},{min:70,rank:"âš”ï¸ Penantang",motivasi:"â€œUji dirimu di medan sulit untuk menjadi lebih kuat.â€ â€“ Bruce Lee"},{min:100,rank:"ğŸŒŸ Juara",motivasi:"â€œJadilah dirimu yang terbaik.â€ â€“ John Wooden"},{min:150,rank:"ğŸ‘‘ Raja Disiplin",motivasi:"â€œDisiplin adalah jembatan antara tujuan dan pencapaian.â€ â€“ Jim Rohn"},{min:200,rank:"ğŸ’ Elite",motivasi:"â€œKetekunan mengalahkan bakat.â€ â€“ Angela Duckworth"},{min:300,rank:"ğŸ¦¾ Titan",motivasi:"â€œKesuksesan adalah milik mereka yang pantang menyerah.â€ â€“ Tony Robbins"},{min:500,rank:"ğŸŒŒ Legenda",motivasi:"â€œOrang yang cukup gila untuk berpikir dia bisa mengubah dunia adalah orang yang melakukannya.â€ â€“ Steve Jobs"},{min:750,rank:"ğŸš¨ Mythical",motivasi:"â€œKebiasaan membentuk karakter, dan karakter menentukan nasib.â€ â€“ Warren Buffett"},{min:1e3,rank:"âš¡ Immortal",motivasi:"â€œKemenangan terbesar adalah menaklukkan diri sendiri.â€ â€“ Plato"}];let e=t[0],n=null;for(let i=0;i<t.length&&a>=t[i].min;i++)e=t[i],n=t[i+1]||null;document.getElementById("userRank").textContent=e.rank;const i=document.getElementById("motivasi");i&&(i.textContent=e.motivasi);let l="";if(n){l=`<br><span style="color:#aaffcc">ğŸ¯ ${n.min-a} poin lagi menuju <b>${n.rank}</b></span>`}else l='<br><span style="color:#ffd700">ğŸ† Kamu sudah mencapai rank tertinggi!</span>';i.innerHTML+=l}function hapusSemua(){confirm("âš ï¸ Yakin ingin menghapus semua data yang tersimpan?")&&(localStorage.removeItem("nativeDailyFullData"),localStorage.setItem("chartWarningVisible","true"),window.grafik&&window.grafik.destroy(),alert("ğŸ—‘ï¸ Data berhasil dihapus!"),location.reload())}textarea.value=initialData.tasksCustom||daftarKegiatan.join("\n"),hitungRataRata(),updateProgressIndicators(),updateProgressIndicators(),muatTabel();const dataLama=getFullData().dailyData;function bukaPopupHistory(){const a=getFullData(),t=document.getElementById("historyContent");if(t.innerHTML="",!a.dailyData||0===a.dailyData.length)return t.innerHTML="<p style='color:#ccc;'>Belum ada data yang tersimpan.</p>",void(document.getElementById("popupHistory").style.display="block");[...a.dailyData].sort(((a,t)=>t.tanggal.localeCompare(a.tanggal))).forEach((a=>{const e=a.tanggal,n=a.skor,i=a.selesai||[],l=Math.round(n/daftarKegiatan.length*100),o=document.createElement("div");o.innerHTML=`\n      <strong>ğŸ“† ${e}</strong><br>\n      âœ… ${n}/${daftarKegiatan.length} kegiatan (${l}%)<br>\n      <ul style="padding-left: 20px; margin-top: 5px; color: #ccffcc;">\n        ${i.map((a=>`<li>âœ”ï¸ ${a}</li>`)).join("")}\n      </ul>\n    `,t.appendChild(o)})),document.getElementById("popupHistory").style.display="block"}function tutupPopupHistory(){document.getElementById("popupHistory").style.display="none"}function copyData(){const a=localStorage.getItem("nativeDailyFullData");if(!a)return alert("âŒ Tidak ada data untuk dicopy!");navigator.clipboard.writeText(a).then((()=>{alert("âœ… Data berhasil dicopy ke clipboard!")})).catch((a=>{alert("âš ï¸ Gagal menyalin data: "+a)}))}function pasteData(){const a=document.createElement("div");a.className="import-overlay",a.innerHTML='\n    <div class="import-box">\n      <h3>ğŸ“¥ Import Data JSON</h3>\n      <textarea id="importTextarea" placeholder="Tempel data hasil copy di sini..."></textarea>\n      <div class="import-actions">\n        <button onclick="applyPastedData()">Simpan</button>\n        <button class="cancel-btn" onclick="this.closest(\'.import-overlay\').remove()">Batal</button>\n      </div>\n    </div>\n  ',document.body.appendChild(a)}function applyPastedData(){const a=document.getElementById("importTextarea").value.trim();if(!a)return alert("âŒ Tidak ada data yang ditempel.");try{const t=JSON.parse(a);localStorage.setItem("nativeDailyFullData",JSON.stringify(t)),alert("âœ… Data berhasil dipulihkan!"),location.reload()}catch(a){alert("âŒ Data tidak valid!\n"+a.message)}}function hitungRataRata(){const a=getFullData();if(!a.dailyData||0===a.dailyData.length)return document.getElementById("avgScore").textContent=0,void updateStatusLevel(0);const t=a.dailyData.reduce(((a,t)=>a+t.skor),0)/a.dailyData.length;a.avgScore=t,saveFullData(a),document.getElementById("avgScore").textContent=t.toFixed(1),updateStatusLevel(t)}function updateStatusLevel(a){const t=document.getElementById("statusLevel");t.className="";let e="";a>=.7*daftarKegiatan.length?(e="Bagus",t.classList.add("status-green")):a>=.4*daftarKegiatan.length?(e="Sedang",t.classList.add("status-yellow")):(e="Buruk",t.classList.add("status-red")),t.textContent=e}function updateProgressIndicators(){const a=getFullData(),t=new Date;function e(e){const n=new Date(t-864e5*e),i=a.dailyData.filter((a=>new Date(a.tanggal)>=n));if(0===i.length)return null;return i.reduce(((a,t)=>a+t.skor),0)/(i.length*daftarKegiatan.length)*100}const n=e(1),i=e(7),l=e(30);function o(a,t){const e=document.getElementById(a);e.className="progress-status",null!==t?(e.textContent=t.toFixed(1)+"%",t>=70?e.classList.add("progress-green"):t>=40?e.classList.add("progress-yellow"):e.classList.add("progress-red")):e.textContent="Belum ada data"}o("dailyProgress",n),o("weeklyProgress",i),o("monthlyProgress",l),a.progressStats={daily:n,weekly:i,monthly:l},saveFullData(a)}dataLama.length>0&&tampilkanGrafik(dataLama),hitungTotalPoin(),applyChartWarningFromStorage(),updateProgressIndicators();
